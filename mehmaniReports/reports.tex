\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx} % Allows you to insert figures
\usepackage{amsmath} % Allows you to do equations
\usepackage{fancyhdr} % Formats the header
\usepackage{geometry} % Formats the paper size, orientation, and margins
\usepackage{caption}
\usepackage{subcaption}
\usepackage[style=authoryear-ibid,backend=biber]{biblatex} % Allows you to do citations - does Harvard style and compatible with Zotero
\addbibresource{Example.bib} % Tells LaTeX where the citations are coming from. This is imported from Zotero
\usepackage[english]{babel}
\usepackage{csquotes}
\renewcommand*{\nameyeardelim}{\addcomma\space} % Adds comma in in-text citations
\linespread{1.25} % About 1.5 spacing in Word
\setlength{\parindent}{0pt} % No paragraph indents
\setlength{\parskip}{1em} % Paragraphs separated by one line
\renewcommand{\headrulewidth}{0pt} % Removes line in header
\geometry{a4paper, portrait, margin=0.7in}
\setlength{\headheight}{14.49998pt}
\usepackage{titlesec}
\titlespacing{\subsection}{1pt}{\parskip}{-\parskip}
\begin{document}
	\begin{titlepage}
		\begin{center}
			\vspace*{5cm}
			
			\Huge{Weekly Reports}
			
			\vspace{0.5cm}
			\LARGE{Mehmani Research Group}
			
			\vspace{3 cm}
			\Large{}
			
			\vspace{0.25cm}
			\large{Nicol√°s Bueno Zapata}
			
			\vspace{3 cm}
			\Large{Spring 2022}
			
			\vspace{0.25 cm}
			\Large{Pennsylvania State University}
			
			
			\vfill
		\end{center}
	\end{titlepage}
	
	\setcounter{page}{2}
	\pagestyle{fancy}
	\fancyhf{}
	\rhead{\thepage}
	\lhead{Nicolas's Reports}
	
	\section*{Jan 30, 2022}
	 During this week I was focoused on testing my LBM code for a single component and multiphase conditions. For validation, I looked for other available codes from the postdoc, Cheng, and codes available in the Dr. Ayala's research group. I had to redefine some objects in my code to be able to pursue the next modeling objectives as:
		
	\begin{itemize}
		\item Have different relaxation parameters for every component
		\item Have more than one force applying to our components 
		\item The components also have the propety "pseudopotential"

	\end{itemize}

	I was reading how to model two immiscible components through LBM, and I discover that the treatment of Cheng is quite different (valid, though) from the proposed in Kruger's book. I created a new routine with a different Shan-Chen force implementation (each component uses its own pseudopotential) for immiscible displacement, because I want to be able to simulate a case where I inject a single component that displaces the other, although I just realize that I need to specify the composition of my injecting fluid for all the boundary conditions we have specified. In single component, specifing the pressure is equivalent to specify the density. However, for multi-component, we need to provide the amount of each component at that pressure to be able to have a solvable system.
	
	I decided to keep track of all the different options and equations inside the code, and I started to write my own LBM document to explain to myself and future users, what are the equations implemented and the logic behind them. 
	
	It has been difficult to balance the time for research, coding, and reading papers where to inspire for research ideas and applications. I am still trying to find the correct point in this semester, as all the courses are kind of related to my thesis, and all deserve the same degree of attention. 
	
	\pagebreak
	
	\section*{Feb 6, 2022}
	
	\subsection*{Things that were done}
	This week started the full implementation of the multi-relaxation-times collision operator for my LBM model. Despite the first coding stage, I had programmed classes for collisionMRT operator and the lbmParameter object, these two were somehow in conflict, as the Fortran polymorphism is somehow more strict than in C++, so I had to arrange the code to account for generalization in the main routines, who do not know in principle, which type of object are they calling to. I read about LAPACK, a library to handle linear systems in Fortran, that could be useful for other problems and applications using the code in development. 
	
	Another advance in this matter was the two-phase flash algorithm that is almost working in C++. The purpose of this code is to have my own library for thermodynamic analysis of mixtures (solve stability, n-phase flash, envelopes, bubble points) that can give insights in how to set a simulation case for the LBM code. The novelity with this code is that is connected with Matplotlib, library from Python, so it can be used any plot command from there in C++. I would like to improve the Subsequent Substitution Method by a Newtonian algorithm using the C++ Library, Eigen, to solve linear systems of equations. 
		
	\subsection*{Difficulties}
	This semester, as particularly intense, has been difficult to balance between study and working times. However, I have managed to take advantage of the homework and classes to enforce my knowledge, especially that related with my field of research and expertise: thermodynamic behavior of mixtures, pore-scale phenomena, scientific-programming, and fluid-flow modeling. I also have come across challenges regarding the object-oriented programming with Fortran. There are plenty resources online, but hardly there is one canonical source as there is for C++. 
	
	\subsection*{Work for next week}
	I will validate the MRT collision operator with the Cheng's codes for single component. After this, I will validate for two components. If I reach this point, I will be able to write the paper that he left in progress, and I can focus on particular problems (applications) and the parallelization with OpenMPI. I will start selecting some papers to delimit the fields where this multiphase model could be applied, as I need to have a goal for the method, so I can take some decisions in advance. As capillary pressure is of our interest, it is worth asking if the 3D implementation is a priority in the research. 
	
	Ask for access to the report template.
	
	\pagebreak
	\section*{Feb 7 - Feb 12}
	\subsection*{What was done last week}
	This week I finished the coding of the multi-relaxation times (MRT) collision operator. As this operator implies the multiplication of matrices and vectors, I used the Fortran built-in operator for this purpose, although later on a manually multiplication can be coded to gain computational speed (that is not a priority right now, but I keep saving notes for future improvements). At this point, it is worth mentioning the simulations I am running make use of an cubic equation of state, that was validated months ago, before taking a detour to validate single phase problems with analytical solutions, that I presented before going to the Winter break. Now, the validation cases combine single or multi-component cases with BGK or MRT as the collision operator. The results of the previous BGK implementation show a successful match between my model and the Cheng's legacy code (Dr. Ayala's post-doc), for static and oscillating droplets of a single component/multiphase model. The MRT model was successfully implemented, and the static droplet case was validated (Figure \ref{fig:val1CMRT}). However, the case for the oscillating droplet has presented difficulties in terms of model interpretability, and results availability (see difficulties). During the week, I wanted to clarify some ideas that were taking me to different directions. As I am conscious about how important it is to focus on a single task, I tried to discriminate between interesting ideas to pursue later, and the important research aspects that have to be addressed from now. So, apart from coding, I made a preliminary review about current multiphase applications where LBM is a suitable model. I found an interesting topic, called self-propelled droplets, where acceleration is exerted by surface tension gradients caused by non-uniform fields of whether surfactant concentration or temperature. This search is obeying my believe on that concrete applications help to visualize and give shape to the current and future code, at the time it motivates me to be in current hot-spots for research (I want to be close to topics of high applicability). In that sense, I discovered the Marangoni-like flow, I found some papers simulating the phenomena with LBM, and I plan to read a couple during the week and possibly bringing them for the next group meeting.  
	
	\begin{figure*}[h]
		\centering
		\includegraphics[scale=0.4]{pics/MRT_StaticDroplet_PRho.png}
		\caption{Comparison of pressure and density.}
		\label{fig:val1CMRT}
	\end{figure*}
	 
	\subsection*{What will be done next week?}
	I will finish the MRT validation against Cheng's codes, but this paradigm is becoming more complex every time, as the codes are extensive and each one changes its input parameters. I feel that attach to simpler but extensively reported cases would be better for our purpose. As the MRT code is already running and giving good results (qualitatively), I consider the two-component case is ready to be addressed. The code is already generalized, so the only missing part is to configure the cases and start running and debugging. 
	
	\subsection*{Difficulties}
	\begin{itemize}
		\item The MRT case does not show several oscillations as the BGK does. 

		\item The BGK has only one parameter that relates to the viscosity of the fluid, so I can control how fast the momentum diffuses through this parameter. However, MRT has more parameters, and sometimes they look like \textit{magic-parameters}, that I am still understanding to produce stable simulations.
		\item There are many validation codes, and handling that amount of versions is becoming overwhelming. How can I generate enough trust in the model?
		\item Side note: The phase behavior model I have in C++ started as a class project the last semester for the Advance Programming course, and is the mandatory project for the Thermodynamics course I am taking this semester. That is the reason I am developing the code, and the fact it is in C++ is because I want to improve my proficiency with high-performance programming languages. 
	\end{itemize}


	\pagebreak
	\section*{Feb 14 - Feb 19}
	\subsection*{What was done last week}
	According to the plan from past week, and given the instructions by Dr. Ayala, I ran again the oscillation droplet for BGK and MRT, and compared against my code. After a tough debugging process, I discovered the cause (difference in numerical parameters) of the discrepancies in the MRT case. Now, both codes are providing the same results for the two collision operators (figure \ref{fig:osci}). This debugging process lead me to repeat the Cheng's previous MRT implementation, that although is manual and cumbersome, accelerates considerable the code as no matrix-vector operations are needed. As a parallel example, I ran the case of a falling droplet, that marked the importance to generalize the viscosity as a value per phase.
	
	I skimmed through some papers studying the Marangoni flow with LBM solvers. Part of this search was presented in the Friday's meeting, where I could understand better (not completely) the phase-field model based on the free-energy functional. Although no research related, I consider important to inform that I sent the documentation to apply for a Minor in Computational Science, although last semester I took most of the credits needed for this goal, and only 6 credits are missing for this purpose, apart from the missing research credits I have pending. 
	
	\begin{figure}[h]
		\centering
		\begin{subfigure}{.5\textwidth}
			\centering
			\includegraphics[width=.6\linewidth]{pics/BGKOsc.pdf}
			\caption{BGK}
			\label{fig:sub1}
		\end{subfigure}%
		\begin{subfigure}{.5\textwidth}
			\centering
			\includegraphics[width=.6\linewidth]{pics/MRTOsc.pdf}
			\caption{MRT}
			\label{fig:sub2}
		\end{subfigure}
		\caption{Oscillation droplet case. Viscosities are different in each case.}
		\label{fig:osci}
	\end{figure}
	
	\subsection*{Difficulties}
	\begin{itemize}
		\item One difficulty raised from the high terminal velocity that a falling droplet reaches due to gravity. I haven't had the time to test a rising bubble (may present a smaller velocity) but it would be a good match example once I fixed the viscosity per phase. In fact, I feel I have not understood the advantages that LBM can provide in terms of physics modeling, and I should be better aware of both its limitations and benefits, compared with the others well-known methods. 
		
		\item I also have had a debugging difficulty with GDB and Fortran, as sometimes the run simply collapse when I intend to access some object's information.
		
		\item I found myself confused with the management of information regarding my own advances and thoughts, and with migrating them from where I was accustom to (Discord, Obsidian).
	\end{itemize}
	 
	
	\subsection*{What will be done next week?}
	I forecast a busy week due to an exam I have on Thursday, the talk given by Dr. Pyrak, two homework for the next week, and a meeting with Dr. Ayala's research group, that includes Cheng as a guest to discuss the LBM difficulties. With the available time, I will start the 2-component case (oscillating droplet). I would like to receive some feedback during next weeks, about the direction we are going with the code and research objectives, maybe in a separate short-meeting between you Dr. Mehmani, and Dr. Ayala. During this week, the meeting with Cheng is particularly important, as there is where I can solve some concerns about LBM that are not clear enough in some books or papers, and where I can connect better with his ideas, and accelerate the paper writing. 
	
	\pagebreak
	\section*{Feb 21 - Feb 26}
	\subsection*{What was done last week}
	This week was predominantly centered around research meetings, talks, and exams. I had a meeting with Dr. Ayala's research group, to show the advances on the new code. One of the conclusions during the meeting was that the outflow boundary condition is still a not-solved problem, as it is no clear what is the implication at the macroscale, the fact of imposing a zero gradient at the mesoscale in only certain directions. The increasing in mass is caused by the bounce back scheme, were the distributions are reflected, causing a net $\Delta m$ non equal zero. In the meeting, they encourage to find the source of mass increasing (if occurring close to the inlet or outlet). Also, recommended to extend the column of fluid for the falling droplet, as the flow generated by the droplet may influence the hydrodynamics of itself using the periodic condition. Cheng also want me to repeat the rotating droplet with my code to see if it can converge. If you remember, Dr. Mehmani, long time ago I showed you a rotating droplet that was gaining momentum and not converging to equilibrium, and Cheng said he had troubles making that case to converge, and is the one I am referring to. It is still needed more exploratory work about the combination of boundary conditions. 
	
	\subsection*{Difficulties}
	\begin{itemize}
		\item I used to employ general correlations for viscosity, such as the Lorentz-Bray-Clark model, that takes into account composition for the viscosity of a mixture. I used this for compositional modeling, but I do not have clear what the implications are in the N-S equations, to apply linear mixing rules. Is the common practice in pore-scale, to treat the viscosity as a linear combination based on densities of the components? I was struggling in deciding which scheme to use, as this may impact: a) The resulting N-S equation that is being reproduced, b) The computational overhead in the code. 
		
		\item No other particular problems were found this week more than the usual about time management.
	\end{itemize}
	
	
	\subsection*{What will be done next week?}
	I will present two exams this week, and I have to finish a report about the phase behavior model in C++. I plan to focus mostly in these three aspects and include the correction to compute the viscosity based on current composition, as this is important to correct the previous multiphase simulation cases, and to address the 2-components simulation.

	
	\pagebreak
	\section*{Feb 28 - Mar 13}
	\subsection*{What was done last week}
	During these two weeks, the front where I spent most of the time was the programming of functionalities needed for addressing the two-component multiphase simulations. I programmed the viscosity interpolation based on density, using two given reference viscosities. I tried to use this modification to make the falling droplet case to converge. I was planning to modify the viscosity of the surrounding vapor high enough to equal the gravity force with the drag force, but I have not found the combination of parameters that produces a stabilization with a terminal velocity within the range  valid for LBM. I skipped this difficulty and left this front in stand-by, in order to prioritize the oscillating droplet using two components. For this purpose, I (a) incorporated the initialization based on composition fields, (b) reported the fluxes at boundary nodes to check the mass conservation (strictly speaking, this still is not a material balance criterion), (c) improved the routines computing the topology of the mesh, to use this information for the Shan-Chen force computation (it depends on neighbors' pseudopotential), and (d) run static and oscillation droplets to start the validation process. With these changes, the force is in agreement with the boundary conditions imposed for the flow, and the implementation for immiscible flow, and fluid-solid interactions are in a 50\% of development.
	
	\subsection*{Difficulties}
	I found out that the outflow boundary conditions I implemented have a mistake in their mathematical form. As the boundary conditions and their generality were not the main focus during the code construction, I only tested rigorously the ones more used by the validation cases (pressure, velocity, and periodic). Now, I know where to find the correct mathematical description of such conditions in order to apply them for the multi-component case. However, for the oscillating droplet I can still work with the periodic boundary conditions. A second difficulty was related with computing the net flux across the boundaries, which I computed as:
	\begin{equation*}
		\dot{m}_b = \sum_{l(b)} \rho_l (\mathbf{u}_l \cdot \mathbf{n}_l) A_l 
	\end{equation*}
	where $l$ stands for a block in the boundary $b$. As the solution for $\rho$ and $\mathbf{u}$ are given at the center of the lattice, this flux is not representative of the real boundary, and a correction for the dynamic variables must be performed. 
	
	\subsection*{What will be done next week?}
	I plan to compare the results of the oscillating droplet with the Cheng's code and his previous paper, and against the analytical solution for the period of oscillation, at the same time I analyze the assumptions behind this equation, and put down the findings during the validation.
	
	\pagebreak
	\section*{Mar 14 - Mar 20}
	\subsection*{What was done last week}
	The main objective of the week was the validation of the oscillation period. For this purpose, I previously had the main simulation, but still the simulations of static droplets with different radii were missing (to compute the interfacial tension, IFT), and no analysis of the oscillation period was done in the last week. These were the two fronts covered with the following results. The Figure \ref{fig:laplace} shows the validation of the Young-Laplace equation, obtaining a surface tension of 0.12141 in LBM units, and is also shown the LBM simulation of the oscillating droplet, compared with the Cheng's code. There is an offset of 3.6 units in the radius, that is product of the increasing mean diameter, an effect that is not seen in Cheng's results. This effect can be better seen in the Figure \ref{fig:2cOsc}, where the mean radius is computed as $R_e = \sqrt{R_x R_y}$. To obtain the frequency, a Fourier transform was employed, where a peak at 10010 T was obtained. 
		\begin{figure}[h]
		\centering
		\begin{subfigure}{.5\textwidth}
			\centering
			\includegraphics[width=1\linewidth]{pics/IFT.pdf}
			\caption{Young-Laplace validation}
		\end{subfigure}%
		\begin{subfigure}{.5\textwidth}
			\centering
			\includegraphics[width=1\linewidth]{pics/2cOsc.pdf}
			\caption{Comparison with Cheng.}
		\end{subfigure}
		\caption{Young-Laplace and Comparison with Cheng.}
		\label{fig:laplace}
	\end{figure}
	
	\begin{figure*}[h]
		\centering
		\includegraphics[scale=0.5]{pics/fourier.pdf}
		\caption{Oscillations and evolution of the mean radius. Fourier transform.}
		\label{fig:2cOsc}
	\end{figure*}
	
	As a summary, the equilibrium radius is equal to 60.59, the interfacial tension to 0.12141, the liquid density to 8.277, and the numerical period equal to 10010 T. Now, to compare against the analytical period, we have the equation:
	\begin{equation}
		T_a = 2 \pi \left[ \frac{n (n^2-1) \sigma}{\rho_l R_e^3} \right]^{-0.5}
	\end{equation}
	That gives a period of 9989 T, that produces an error of 0.2\%. I found a problem with Cheng's paper, where the exponent of -0.5 is missing. 
	
	\subsection*{Difficulties}
	I may have one problem during the initialization stage. All the simulations are depicting an increase in the droplet radius, so the first oscillations are not centered around the equilibrium value, as if the interface were to accumulate energy at time zero. I am trying to figure out if this is product of the interface size, the method used to locate the interface, or an initialization problem. This effect was not present during the single component case.
	
	\subsection*{What will be done next week?}
	I will work on the problem of the increasing radius to discover what is causing this effect, which I consider critical to keep advancing to other cases. I also need to test the same simulation, activating a correction term of MRT that reduces spurious currents, and that is present in some of the Cheng's simulations.
	
	\pagebreak
	\section*{Mar 21 - Mar 27}
	\subsection*{What was done last week}
		The purpose of this week was to present the advances in the validation cases to the Dr. Ayala research group and decide how to continue in the direction of finishing the cases that will go to the paper. To be honest, I realized that I have been working in a dispersed way, where part of my work, focused on simulation, was spent in finding the cause of not matching as I would like, the Cheng's results. Although the analytical solutions have matched really well, I keep thinking that to drop all the legacy codes, I should be able to match the cases that were left by Cheng, or at least explain the differences. Simultaneously, I ran some initial cases for the rising bubble to validate the model under the action of gravity. Before going further in this direction, I need to do a bibliographic review that will be better stated in the last section of the report. 
		
	\subsection*{Difficulties}
	
	Although I could relax the demand to myself of matching perfectly the Cheng's code, I am still struggling with the droplet increase during the first cycle of oscillations in the multi-component case. I did not experience this effect during single-component simulations, but comparing a very refined simulations (in terms of time resolution), turns out that the increase appears after 1000 time iterations, and only in one of the droplet sides (right). After a while, the left side also increases, and then both are stable. It is worth saying that this difference is about half the size of the diffuse interface, but, although it sounds small, by where the differences are in the codes and the phenomenological nature of this effect\footnote{I am assuming this is not product of numerical errors}, there should be not discrepancy. Regarding the raising droplet, I realized that an uniform force is only valid to model gravity when there are not periodic conditions in the force direction.
	
	\subsection*{What will be done next week?}
	I consider important to pause and make some decisions before taking the next step with more confidence and to avoid the dispersivity feeling. First, I will do a bibliographic review of the oscillating droplet to see how other authors have presented this kind of simulations with LBM or other modeling techniques. Also, I will gather several approaches to include the gravity in the multi-phase approach, where I have found a couple of methods. In summary, this week should be focused on: bibliographic review of droplet oscillations and rising bubbles with multiphase models. Regarding to code, I need help with deciding if it is important to keep looking for the cause of the increasing radius (again, it happens during the first complete oscillation, but I have not read this in other papers). If it is relevant, I need to propose a systematic way to find the reason, because up to now, I have tried many things that have not solved the "problem" and now any other try will increase the entropy of this search.
	
	\pagebreak
	\section*{Mar 28 - Apr 11}
	\subsection*{What was done last week}
	I searched for papers 
	
	Dr. Ayala proposed a solution to find the reason 
	
	Homeworks
	
	
	\subsection*{Difficulties}
	
	Family situation 
	\subsection*{What will be done next week?}
	
	Judge
	
	Symmetric evaluation
	
	Paper reading
	
	
	
	
	%\pagebreak
	%\section*{Feb 7 - Feb 12}
	%\subsection*{What was done last week}
	%\subsection*{Difficulties}
	%\subsection*{What will be done next week?}
	\printbibliography % Be sure to remove access date and months from the .bib file
\end{document}